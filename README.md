# Next JS 14

In Next JS all React components are server components by default unless initiated with the `"use client"` top directive. Since hooks can only be used in client component make sure start them with that directive.

## Routing

### The app router

While the `app` folder is mapped to the **url domaine name** every subfolder ending up with a `page.tsx` file, is mapped to **url path.** _Example:_ `project/src/app/about/page.tsx` is mapped to `domaineName/about`

### Dynamic routes

Dynamic routes are created by wrapping square brackets around a url segment (`app/[productID]/reviews/[reviewID]/page.tsx`). To retreive those segments Within the subcomponents use the `param prop`, an object with a property for each segment:

```typescript
export default function Review({
  params,
}: {
  params: { productId: string; reviewId: string };
}) {

  return (
    <h1>
      Review {params.reviewId} of product {params.productId}
    </h1>
  );
}
```

### Catch all segment

To route to a ramdomly named segment mapping to anything use `[[...anyName]]`. _Example:_ `project/src/app/docs/[[...slug]]/page.tsx`

```typescript
export default function Docs({ params }: { params: { slug: string[] } }) {
	 // You can taylor page content according to route
  const content = (function () {
    if (params.slug) {
      switch (params.slug.length) {
        case 1:
          return `Viewing docs for features ${params.slug[0]}`;
        case 2:
          return `Viewing docs for features ${params.slug[0]} and concept ${params.slug[1]}`;
      }
    } else {
	  // Or return a default content in case of no ramdom segment
      return "Docs home page";
    }
  })();

  return <h1>{content}</h1>;
}
```

### Not found page

It can be customized by providing each route with a `not-found` file. Or loading that file from a nested route with the function:

```typescript
import { notFound } from "next/navigation";
```

### File colocation

It is perfectly ok to save component file next to reserved-named file within a same route folder. Next JS won't map them to any route. However it is better to keep them in some `component` folder next to the `app` folder.

### Private route

when you need to prevent Next JS from routing a folder just prefixe it with **underscore `_`**. However if you need a route to start with underscore you have to prefixe it with the encode version of it as `%F5`.

| **app subfloder** | **url entered** | **http status** |
| ----------------- | --------------- | --------------- |
| `/_lib`           | host/\_lib      | **404**         |
| `/%F5lib`         | host/\_lib      | **200**         |

### Route group

To enhance **DX** sometimes you need to group some specific folders within the same directory while keeping this directory out of url mapping by naming it `(directory)`. _Example:_

| **app subfloder**  | **url**       |
| ------------------ | ------------- |
| `/(auth)/login`    | host/login    |
| `/(auth)/register` | host/register |

## Layout

To apply consistent layout to a route and all its subroutes use the `layout` file, which receive as `children React.node` the `page` file or all sub routes.

```typescript
export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>
        // Enhance UI as you wish
        {children}
        // Enhance UI as you wish
      </body>
    </html>
  );
}
```

The `RootLayout` component is automatically generated by Next JS even if you delete it.

### Nested layout

When you want to apply a specific layout to a route. In the following example the `RootLayout` will aplly to all project before any **sub layout** is included.

```bash
app/
├── products
│   ├── [productId]
│   │   ├── layout.tsx # nested layout
│   │   ├── page.tsx
│   │   └── reviews
│   │       └── [reviewId]
│   │           └── page.tsx
│   └── page.tsx
├── layout.tsx
├── not-found.tsx
└── page.tsx
```

| **url**      | **`RootLayout {children}`** | **final UI**                                                           |
| ------------ | --------------------------- | ---------------------------------------------------------------------- |
| /            | `/page`                     | home page                                                              |
| /products    | `/producs/page`             | products page                                                          |
| /about       | `/about/page`               | about page                                                             |
| /products/12 | `/products/12/layout`       | product 12 page (**Since it's in turn `this nested layout children`**) |

### Route group layout

When you need to apply a layouyt some route segments excluding some other segments at the same level use route groupe.

```bash
app/(auth)/
├── (with-auth-layout) # route group to restrict layout
│   ├── layout.tsx # route group layout
│   ├── login
│   │   └── page.tsx
│   └── register
│       └── page.tsx
└── forgot-password
    └── page.tsx
```

While `/login` and `/register` url will have some common UI from `/app/(auth)/(with-ayth-layout)/layout.tsx` file, `/forgot-password` url won't have it.

## Metadata and SEO

For SEO optimization, Next JS introduce the **Metadata API** to taylor metadata for each page. For this either:

- export a **static `metadata` object** or
- export a **dynamic `generateMetadata` function** that returns an **object with metadata as properties.**

For example defining the two following codes respectively in two different components, will overwrite the default **page `title`** from the `RootLayout` component `metadata` object.

```typescript
// in app/about/page.tsx
export const metadata = {
  title: "About Codevolution",
};
// in app/produtcs/[productID]/page.tsx
import { Metadata } from "next";

export const generateMetadata = ({ params }: ProductProps): Metadata => {
  return {
    title: `Product ${params.productId}`,
  };
};
```

### Title metadata

Its can either a `string` or an `object`. In the following directory as example:

```bash
app/
├── layout.tsx
├── not-found.tsx
├── page.tsx
├── about
│   └── page.tsx
├── blog
│   └── page.tsx
└── products
    ├── [productId]
    │   ├── layout.tsx
    │   └── page.tsx
    └── page.tsx
```

Starting from the `RootLayout` component, the following code will default the title of any route with metadata export to **"Next.js - Codevolution"**:

```typescript
// RootLayout component
export const metadata: Metadata = {
  title: {
    // absolute: "",
    template: "%s | Codevolution",
    default: "Next.js - Codevolution",
  },
  description: "Generated by Next.js",
};
```

Sub route exporting metadata as `string`, will have it substitute with the **`"%s"`** string from the parent route and assigned the title of the resulting **title template property.**

```typescript
// app/blog/page.tsx
export const metadata: Metadata = {
  title: "Blog",
};
// page title => "Blog | Codevolution"
```

For sub route to overwrite that default title or template, they must either, export `metadata` as an object with an `absolute` property:

```typescript
// app/about/page.tsx
export const metadata: Metadata = {
  title: {
    absolute: "About Codevolution",
  },
};
// page title => "About Codevolution"
```

or export the `generateMetadata` function (optionally asynchronous) returning the very object.

```typescript
// file: app/products/[productId]/page.tsx
// url: host/products/12
export const generateMetadata = async ({
  params,
}: ProductProps): Promise<Metadata> => {
  const productName = await new Promise((resolve) => {
    setTimeout(() => {
      resolve(`Samsung ${params.productId}`);
    }, 200);
  });

  return {
    title: {
      absolute: `Product ${productName}`,
    },
  };
};
// page title => "Product Samsung 12"
```

## Navigation

Navigation is simply achieved by using the Next JS `Link` component the extends the HTML anchor `<a></a>` element:

```typescript
// import
import Link from "next/link";
// use
<Link href={"/"}>Home</Link>
// or replace in history current directory
<Link href={"/about"} replace>Home</Link>
```

### Active link

To detect **active links,** Next JS provide the `usePathname` destructured from `"next/navigation"`, and better **to invoque from within a layout component.**
Use it or some of its method to style active links accordingly:

```typescript
"use client";
import { usePathname } from "next/navigation";
// within client component
const pathName = usePathname();
// within Link className prop apply conditional style with
pathName === "/about"; // or
pathName.startsWith("/about");
```
